apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-init-config
  namespace: file-sharing
data:
  init-mongo.js: |
    // Простая инициализация без аутентификации
    print('Starting MongoDB initialization for Gokapi...');
    
    // Создаем базу данных gokapi
    db = db.getSiblingDB('gokapi');
    
    // Создаем коллекции
    db.createCollection('files');
    db.createCollection('api_keys');
    db.createCollection('settings');
    
    // Создаем индексы
    db.files.createIndex({ "id": 1 }, { unique: true });
    db.files.createIndex({ "expireAt": 1 }, { expireAfterSeconds: 0 });
    db.files.createIndex({ "uploadDate": -1 });
    
    print('✅ Gokapi database initialized successfully');